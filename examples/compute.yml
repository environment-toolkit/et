class: compute
code: site

data:
  aws:
    role: arn:aws:iam::211125614781:role/et-deployment
    state:
      bucket: et-example-prod
      role: arn:aws:iam::211125614781:role/et-bucket

service:
  type: container
  data:
    cluster: cluster
    image: {{ env:image }}
    port: 8080
    desired: 2
    cpu: 256
    memory: 512
    secrets:
      SECURITY_SIGNKEY: {{ secret:signkey }}
    target:
      edge: api
      health:
        path: /live
        port: 8082
        timeout: 25
        interval: 30
        unhealthy_threshold: 5
        healthy_threshold: 5
      rules:
        - path: /stacks/import
          priority: 100
  overrides:
    environments:
      - environment: prod
        data:
          env_vars:
            UGLYDOMAIN_DOMAIN: n-cc.net

resources:
  - code: events
    type: queue
    data:
      is_fifo: true
      subscription: events
  - code: db
    type: database
    data:
      cluster: database

access:
  inbound:
    - api # not really needed since the edge references the api
  outbound:
    - config # not really needed since the container references the config
    - identity # not really needed since the container references the identity
